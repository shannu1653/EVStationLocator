<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nearby EV Charging Stations</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
/* ========== GLOBAL ========== */
body{
  margin:0;
  font-family:"Segoe UI",Arial,sans-serif;
  background:#f4f6f9;
  transition:0.3s;
}

header{
  background:linear-gradient(135deg,#0a7cff,#005ad6);
  color:#fff;
  padding:18px;
  text-align:center;
  font-size:22px;
  font-weight:600;
}

/* ========== CONTROLS ========== */
.controls{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  padding:12px;
}

select,button{
  padding:10px 14px;
  border-radius:12px;
  border:none;
  font-size:14px;
}

button{
  background:#0a7cff;
  color:#fff;
  cursor:pointer;
}
button:hover{background:#005ad6}

/* ========== MAP ========== */
#map{height:320px}

/* ========== CARDS ========== */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:16px;
  padding:16px;
}

.card{
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
  animation:fadeUp .6s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

.card.active{
  border:2px solid #00c853;
  background:#f3fff7;
}

.card h3{margin:0 0 8px}
.card p{margin:4px 0;font-size:14px}

.card button{width:100%;margin-top:10px}

/* Badge */
.badge{
  display:inline-block;
  background:#e6f0ff;
  color:#003c9e;
  padding:4px 8px;
  border-radius:8px;
  font-size:12px;
}

/* Toast */
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#0a7cff;
  color:white;
  padding:12px 20px;
  border-radius:20px;
  animation:toast 3s forwards;
}

@keyframes toast{
  0%{opacity:0}
  10%{opacity:1}
  90%{opacity:1}
  100%{opacity:0}
}

/* Dark Mode */
body.dark{background:#121212;color:#fff}
body.dark header{background:#000}
body.dark .card{background:#1e1e1e}
</style>
</head>

<body>

<header>Nearby EV Charging Stations</header>

<div class="controls">
  <select id="travelMode">
    <option value="driving">üöó Driving</option>
    <option value="walking">üö∂ Walking</option>
    <option value="bicycling">üö≤ Cycling</option>
  </select>

  <button onclick="sortNearest()">üìä Sort Nearest</button>
  <button onclick="toggleDark()">üåô Dark Mode</button>
</div>

<div id="map"></div>
<div class="cards" id="stationList"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ========== GLOBAL VARIABLES ========== */
let map,userLat,userLng;

/* ========== DEMO REAL STATIONS ========== */
const stations=[
  {name:"ChargeZone ‚Äì Kukatpally",lat:17.4933,lng:78.3996,power:"50 kW"},
  {name:"Jio BP Pulse ‚Äì Madhapur",lat:17.4483,lng:78.3915,power:"60 kW"},
  {name:"Ather Grid ‚Äì Gachibowli",lat:17.4401,lng:78.3489,power:"25 kW"},
  {name:"Tata Power EV ‚Äì Banjara Hills",lat:17.4123,lng:78.4484,power:"30 kW"}
];

/* ========== USER LOCATION ========== */
navigator.geolocation.getCurrentPosition(
  pos=>{
    userLat=pos.coords.latitude;
    userLng=pos.coords.longitude;
    initMap();
    renderStations();
  },
  ()=>{
    userLat=17.3850;
    userLng=78.4867;
    initMap();
    renderStations();
  }
);

/* ========== MAP ========== */
function initMap(){
  map=L.map("map").setView([userLat,userLng],13);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
    attribution:"¬© OpenStreetMap"
  }).addTo(map);

  L.marker([userLat,userLng]).addTo(map)
    .bindPopup("You are here").openPopup();

  stations.forEach(s=>{
    L.marker([s.lat,s.lng]).addTo(map).bindPopup(s.name);
  });
}

/* ========== DISTANCE (HAVERSINE) ========== */
function distance(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+
    Math.cos(lat1*Math.PI/180)*
    Math.cos(lat2*Math.PI/180)*
    Math.sin(dLon/2)**2;
  return (R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))).toFixed(2);
}

/* ========== RENDER STATIONS ========== */
function renderStations(){
  const list=document.getElementById("stationList");
  list.innerHTML="";

  stations.forEach((s,i)=>{
    const d=distance(userLat,userLng,s.lat,s.lng);
    s.dist=d;

    list.innerHTML+=`
      <div class="card">
        <h3>${s.name}</h3>
        <p>üìè Distance: ${d} km</p>
        <p><span class="badge">‚ö° ${s.power}</span></p>

        <button onclick="openMaps(${s.lat},${s.lng},'${s.name}')">
          üß≠ Get Directions
        </button>

        <button onclick="saveFav('${s.name}')">
          ‚ù§Ô∏è Save
        </button>
      </div>
    `;
  });
}

/* ========== SORT NEAREST ========== */
function sortNearest(){
  stations.sort((a,b)=>a.dist-b.dist);
  renderStations();
}

/* ========== GOOGLE MAPS NAVIGATION ========== */
function openMaps(lat,lng,name){
  showToast("Opening Google Maps‚Ä¶");

  const mode=document.getElementById("travelMode").value;
  const url=`https://www.google.com/maps/dir/?api=1&origin=${userLat},${userLng}&destination=${lat},${lng}&travelmode=${mode}`;

  const isMobile=/Android|iPhone|iPad/i.test(navigator.userAgent);

  if(isMobile){
    window.location.href=url;
  }else{
    window.open(url,"_blank");
  }
}

/* ========== FAVORITES ========== */
function saveFav(name){
  let fav=JSON.parse(localStorage.getItem("fav"))||[];
  if(!fav.includes(name)){
    fav.push(name);
    showToast("Added to favorites");
  }else{
    showToast("Already saved");
  }
  localStorage.setItem("fav",JSON.stringify(fav));
}

/* ========== TOAST ========== */
function showToast(msg){
  const t=document.createElement("div");
  t.className="toast";
  t.innerText=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3000);
}

/* ========== DARK MODE ========== */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true"){
  document.body.classList.add("dark");
}
</script>

</body>
</html>
